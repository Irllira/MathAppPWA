@page "/RoundUpDown"
@using DTO.DTOs
@using Microsoft.AspNetCore.Components.Authorization
@using global::FrontEnd.Components.Classes
@using global::FrontEnd.Components.Pages.Games.RoundingUpDown
@inject NavigationManager NavManager

@rendermode InteractiveServer
@inherits RoundUpDownBase;

<PageTitle>Zaokrąglanie</PageTitle>


@if(ready==true)
{
    <h1 style="text-align:center">Podaj Poprawną Liczbę </h1>

    <h2><b> @excercise </b></h2>
    <p></p>
    <InputText @bind-Value="UserAnwser" @onkeydown="@Enter" />
    <p></p>
    <button class="confbtn" @onclick="Confirm">Potwierdź</button>
    <p>@gameBase.message</p>
    <p></p>
    <p>Wynik: @gameBase.good / @gameBase.all </p>
}else
{
    <h2 style="text-align:center"><b>Koniec Gry!</b></h2>
    <p style="height:10px"></p>
    <h4>Twój wynik to: @gameBase.good / @gameBase.all </h4>
}

<p style="height:50px"></p>
<button class="backbtn" @onclick="GoBack">Cofnij</button>


@code {
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }

    GamesBase gameBase = new GamesBase("Liczby Naturalne", "Gry");
    private string UserAnwser="";


    private async Task Confirm()
    {
        if (UserAnwser == correctNumber.ToString())
        {
            await gameBase.GoodAnswer();
            if (gameBase.all >= 10)
            {
                await gameBase.UpdateUserScore(authenticationStateTask, userProgressService);
                ready = false;
                return;
            }
            PrepareNewGame();
            UserAnwser = "";
        }
        else
        {
            await gameBase.WrongAnswer();
        }
    }

    public async Task Enter(KeyboardEventArgs e)
    {
        if (e.Code == "Enter" || e.Code == "NumpadEnter")
        {
            await Task.Delay(500);
            await Confirm();
        }
    }

    private async Task GoBack()
    {
        await gameBase.UpdateUserScore(authenticationStateTask, userProgressService);
        NavManager.NavigateTo("ChooseGame/uname/Liczby Naturalne");
    }
}
