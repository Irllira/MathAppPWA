@page "/OperationOrder"
@using DTO.DTOs
@using Microsoft.AspNetCore.Components.Authorization
@using global::FrontEnd.Components.Classes
@using global::FrontEnd.Components.Pages.Games.OperationOrder
@inherits OperationOrderBase;
@rendermode InteractiveServer
@inject NavigationManager NavManager

<PageTitle>Kolejność wykonywania działań</PageTitle>


@if(ready==true)
{
    <h1 style="text-align:center">Wybierz które działanie należy wykonać pierwsze </h1>
    <h2><b> @excercise </b></h2>
    <p></p>

    for (int i=0;i<anwsers.Count();i++)
    {
        var buttonNumber = i;

            <button class="gamebtns" @onclick="@(e => Check(e, anwsersType[buttonNumber], buttonNumber))">@anwsers[i]</button> 
            <label style="padding-left:15px"></label>
        
    }
        
    <p style="height:5px"></p>
    <p role="status">@gameBase.message</p>
    <p style="height:5px"></p>
    <p>Wynik: @gameBase.good / @gameBase.all </p>
}else
{
    <h2 style="text-align:center"><b>Koniec Gry!</b></h2>
    <p style="height:10px"></p>
    <h4>Twój wynik to: @gameBase.good / @gameBase.all </h4>
}

<p style="height:50px"></p>
<button class="backbtn" @onclick="GoBack">Cofnij</button>


@code {
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }

    GamesBase gameBase = new GamesBase("Kolejność Wykonywania Działań","Gry");


    private async Task Check(MouseEventArgs e,int anType, int buttonNumber)
    {
        for(int i = 0;i<anwsersType.Count();i++)
        {
            if(anwsersType[i]>anType)
            {
                await gameBase.WrongAnswer();
                return;
            }                   
        }
        await gameBase.GoodAnswer();
        if(gameBase.all>=10)
        {
            ready = false;
            await gameBase.UpdateUserScore(authenticationStateTask,userProgressService);
            return;
        }
        PrepareNewGame();
    }

    private async Task GoBack()
    {
        await gameBase.UpdateUserScore(authenticationStateTask, userProgressService);

        NavManager.NavigateTo("ChooseGame/uname/Kolejność Wykonywania Działań");
    }
}
