@page "/FractionsOperations/{operationType}"
@using DTO.DTOs
@using Microsoft.AspNetCore.Components.Authorization
@using global::FrontEnd.Components.Classes
@using global::FrontEnd.Components.Pages.Games.Fractions.Operations
@rendermode InteractiveServer
@inherits FractionsOperationsBase;
@inject NavigationManager NavManager


<PageTitle>Działania na Ułamkach</PageTitle>


@if(ready == true)
{
    <h1 style="text-align:center">Podaj poprawną liczbę</h1>
    <p style="height:10px"></p>

    <h2>
        <b>
            <div class="frac">
                <span>@numerator[0]</span>
                <span class="symbol">/</span>
                <span class="bottom"> @denominator[0] </span>
            </div>   @sym 

            <div class="frac">
                <span>@numerator[1]</span>
                <span class="symbol">/</span>
                <span class="bottom"> @denominator[1] </span>
            </div> =
        </b>

        @if (diffden == true){
            var s = sym;
            if (sym == ':')
            {
                s = '*';
            }
            <b>
                    <div class="frac">
                    <span><InputNumber @bind-Value="userHelpNum[0]" @onkeydown="@Enter" style="width:50px;font-size:20px" /></span>
                    <span class="symbol">/</span>
                    <span class="bottom"> <InputNumber @bind-Value="userHelpDen[0]" @onkeydown="@Enter" style="width:50px;font-size:20px" /> </span>
                </div>   @s

                <div class="frac">
                    <span><InputNumber @bind-Value="userHelpNum[1]" @onkeydown="@Enter" style="width:50px;font-size:20px" /></span>
                    <span class="symbol">/</span>
                    <span class="bottom"> <InputNumber @bind-Value="userHelpDen[1]" @onkeydown="@Enter" style="width:50px;font-size:20px" /> </span>
                </div> =
            </b>
            
        }

        <b><div class="frac">
            <span><InputNumber @bind-Value="userNum" @onkeydown="@Enter" style="width:50px;font-size:20px" /></span>
            <span class="symbol">/</span>
            <span class="bottom"> <InputNumber @bind-Value="userDen" @onkeydown="@Enter" style="width:50px;font-size:20px" /> </span>
        </div></b>

    </h2>

    <p style="height:5px"></p>
    <button class="confbtn" @onclick="CheckAnwsers">Potwierdź</button>
    <p style="height:5px"></p>
    <p>@gameBase.message</p>
    <p style="height:5px"></p>
    <p>Wynik: @gameBase.good / @gameBase.all </p>
    
}else
{
    <h2 style="text-align:center"><b>Koniec Gry!</b></h2>
    <p style="height:10px"></p>
    <h4>Twój wynik to: @gameBase.good / @gameBase.all </h4>
}

<p style="height:50px"></p>
<button class="backbtn" @onclick="GoBack">Cofnij</button>


@code {
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }

    public int userNum;
    public int userDen;

    public int[] userHelpNum = new int[2];
    public int[] userHelpDen = new int[2];


    GamesBase gameBase = new GamesBase("Ułamki","Gry");

    private async Task CheckAnwsers()
    {
        if (userNum == correctNum && userDen ==correctDen)
        {
            await gameBase.GoodAnswer();
            if(gameBase.all >= 10)
            {
                await gameBase.UpdateUserScore(authenticationStateTask,userProgressService);
                ready = false;
                return;
            }
            PrepareNewGame();
            userNum = 0;
            userDen = 0;
            userHelpNum = [0, 0];
            userHelpDen = [0, 0];
        }else
        {
            if ((double)userNum / userDen == (double)correctNum / correctDen)
            {
                await gameBase.GoodAnswer();
                if (gameBase.all >= 10)
                {
                    await gameBase.UpdateUserScore(authenticationStateTask, userProgressService);
                    ready = false;
                    return;
                }
                PrepareNewGame();
                userNum = 0;
                userDen = 0;
                userHelpNum = [0, 0];
                userHelpDen = [0, 0];
            }
            else
            {
                await gameBase.WrongAnswer();
                userNum = 0;
                userDen = 0;
            }

        }
    }

    public async Task Enter(KeyboardEventArgs e)
    {
        if (e.Code == "Enter" || e.Code == "NumpadEnter")
        {
            await Task.Delay(500);
            await CheckAnwsers();
        }
    }

    private async Task GoBack()
    {
        await gameBase.UpdateUserScore(authenticationStateTask, userProgressService);
        NavManager.NavigateTo("ChooseGame/uname/Ułamki");
    }
}

