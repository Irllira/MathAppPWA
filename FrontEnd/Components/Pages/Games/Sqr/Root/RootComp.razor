@page "/RootComp"
@using Microsoft.AspNetCore.Components.Authorization
@using global::FrontEnd.Components.Pages.Games.Sqr.Root
@inherits RootCompBase;
@inject NavigationManager NavManager
@rendermode InteractiveServer


@if(ready==true)
{
    <h1 style="text-align:center">Podaj Liczbę Całkowitą Mniejszą i Większą od pierwiastka </h1>
    <p style="height:10px"></p>
   
    <left>
        @if(power==2)
        {
            <h2><b>
                <InputNumber @bind-Value="UserSmallerNumber" style="width:50px;font-size:20px"></InputNumber> &lt; &radic; @exerciseNumber &lt; <InputNumber @bind-Value="UserBiggerNumber" style="width:50px;font-size:20px"></InputNumber>
            </b></h2>
        }else
        {
            <h2><b> &#8731 @exerciseNumber  = </b></h2>
        }

        <p style="height:5px"></p>
        <button class="confbtn" @onclick="Confirm">Potwierdź</button>
        <p></p>
        <button class="game2btns" @onclick="Help">Pomoc</button>
        <p style="height:5px"></p>
        <p>@message</p>
        <p style="height:5px"></p>
        <p>Wynik: @good / @all </p>
        <p style="height:50px"></p>
        <button class="backbtn" @onclick="GoBack">Cofnij</button>
    </left>

    if (showHelp == true)
    {
        <right>
            <p style="font-size:20px">
                Podaj pierwiastkowalną liczbę mniejszą od @exerciseNumber:
                <InputNumber @bind-Value="helpSmaller" style="width:50px;font-size:15px"></InputNumber>
            </p>

            <p style="font-size:20px">
                Podaj pierwiastkowalną liczbę większą od @exerciseNumber:
                <InputNumber @bind-Value="helpBigger" style="width:50px;font-size:15px"></InputNumber>
            </p>
            <p> @helpMessage1</p>
            <p> @helpMessage2</p>

            @if (showHelpNext == true)
            {
                <p></p>
                <p style="font-size:20px"> @helpSmaller &lt; @exerciseNumber &lt; @helpBigger</p>
                <p style="font-size:20px"> &radic; @helpSmaller &lt;  &radic;  @exerciseNumber &lt;  &radic; @helpBigger</p>
                <p></p>
                <p style="font-size:20px"> &radic; @helpSmaller = <InputNumber @bind-Value="UserSmallerNumber" style="width:50px"></InputNumber></p>
                <p style="font-size:20px"> &radic; @helpBigger = <InputNumber @bind-Value="UserBiggerNumber" style="width:50px"></InputNumber></p>
            }
            else
            {
                <button class="backbtn" @onclick="@NextHelp">Dalej</button>
            }
        </right>
    }
    else
    {
        <right> </right>
    }

   
}else
{
        <h2 style="text-align:center"><b>Koniec Gry!</b></h2>
        <p style="height:10px"></p>
        <h4>Twój wynik to: @good / @all </h4>

        <p style="height:50px"></p>
        <button class="backbtn" @onclick="GoBack">Cofnij</button>
}


@code {
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }

    int UserBiggerNumber = 0;
    int UserSmallerNumber = 0;

    int good = 0;
    int all = 0;
    private string message = "";
    private string theEnd = "";

    private int helpBigger = 0;
    private int helpSmaller = 0;
    private bool showHelp = false;
    private bool showHelpNext = false;
    private string helpMessage1 = "";
    private string helpMessage2 = "";


    private async Task Confirm()
    {
        if (UserSmallerNumber == correctSmallerNumber && UserBiggerNumber == correctBiggerNumber)
        {
            await GoodNumber();
        }
        else
        {
            await WrongNumber();
        }
    }


    private async Task GoodNumber()
    {
        good++;
        all++;
        message = "Dobrze!";
        this.StateHasChanged();
        if (all >= 10)
        {
            theEnd = "Koniec gry!";
            ready = false;
            await Task.Delay(1500);
            message = "";
            this.StateHasChanged();
            return;
        }

        await Task.Delay(1500);
        PrepareNewGame();
        message = "";
        UserBiggerNumber = 0;
        UserSmallerNumber = 0;
        helpBigger = 0;
        helpSmaller = 0;
        showHelp = false;
        showHelpNext = false;

        this.StateHasChanged();

    }
    private async Task WrongNumber()
    {
        all++;
        message = "Zła Odpowiedź! Spróbuj ponownie";
        this.StateHasChanged();

        await Task.Delay(1500);

        message = "";

    }

    private void Help()
    {
        if (showHelp == true)
        {
            showHelp = false;
            // showHelpNext = false;
        }
        else
        {
            showHelp = true;
            showHelpNext = false;
        }
    }

    private void GoBack()
    {
        NavManager.NavigateTo("ChooseGame/uname/Potęgi i Pierwiastki");
    }

    private void NextHelp()
    {
        if(helpBigger == correctBiggerNumber*correctBiggerNumber && helpSmaller == correctSmallerNumber* correctSmallerNumber)
        {
            showHelpNext = true;
            helpMessage1 = "";
            helpMessage2 = "";
        }else
        {
            if (helpBigger == correctBiggerNumber * correctBiggerNumber)
            {
                helpMessage1 = "Większa liczba dobrze wpisana";

            }else
            {
                helpMessage1 = "Większa liczba źle wpisana";
            }
            if (helpSmaller == correctSmallerNumber * correctSmallerNumber)
            {
                helpMessage2 = "Mniejsza liczba dobrze wpisana";

            }
            else
            {
                helpMessage2 = "Mniejsza liczba źle wpisana";
            }
        }
    }
}
