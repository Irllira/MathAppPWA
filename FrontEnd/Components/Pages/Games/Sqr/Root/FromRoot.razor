@page "/FromRoot"
@using DTO.DTOs
@using Microsoft.AspNetCore.Components.Authorization
@using global::FrontEnd.Components.Classes
@using global::FrontEnd.Components.Pages.Games.Sqr.Root
@inherits FromRootBase;
@inject NavigationManager NavManager
@rendermode InteractiveServer


@if (ready == true)
{
    <h1 style="text-align:center">Wyciągnij Liczbę Całkowitą Przed Pierwiastek </h1>
    <p style="height:10px"></p>
    <left>
        @if (power == 2)
        {
            <h2><b>
                    &radic; @exerciseNumber = <InputNumber @bind-Value="UserFullNumber" style="width:50px;font-size:20px"></InputNumber> &radic; <InputNumber @bind-Value="UserRoot" style="width:50px;font-size:20px"></InputNumber>
            </b> </h2>
        }
        else
        {
            <h2><b> &#8731 @exerciseNumber  = </b></h2>
        }
        <p style="height:5px"></p>
        <button class="confbtn" @onclick="Confirm">Potwierdź</button>
        <p></p>
        <button class="game2btns" @onclick="Help">Pomoc</button>

        <p style="height:5px"></p>
        <p>@gameBase.message</p>
        <p style="height:5px"></p>
        <p>Wynik: @gameBase.good / @gameBase.all </p>
        <p style="height:50px"></p>
        <button class="backbtn" @onclick="GoBack">Cofnij</button>
    </left>
    if (showHelp == true)
    {
        <right>
            <p style="font-size:25px"> @exerciseNumber można zapisać jako:</p>
            <p style="font-size:20px">
                @exerciseNumber =
                <InputSelect @bind-Value="helpFull" , @onchange="@((ChangeEventArgs __e) => helpFull = __e?.Value?.ToString())">
                    @foreach (var root in rootable)
                    {
                        <option value="@root">@root</option>
                    }

                </InputSelect>

                *
                <InputNumber @bind-Value="UserRoot" style="width:50px;font-size:15px"></InputNumber>
            </p>

            <p></p>
            <p style="font-size:20px">
                &radic; @helpFull =
                <InputNumber @bind-Value="UserFullNumber" style="width:50px;font-size:15px"></InputNumber>
            </p>
            <p></p>

            <p> @helpMessage1</p>
            <p> @helpMessage2</p>


        </right>
    }
    else
    {
        <right> </right>
    }
}
else
{
    <h2 style="text-align:center"><b>Koniec Gry!</b></h2>
    <p style="height:10px"></p>
    <h4>Twój wynik to: @gameBase.good / @gameBase.all </h4>

    <p style="height:50px"></p>
    <button class="backbtn" @onclick="GoBack">Cofnij</button>
}


@code {
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }

    int UserRoot = 0;
    int UserFullNumber = 0;

    GamesBase gameBase = new GamesBase("Potęgi i Pierwiastki","Gry");

    private int helpRoot = 0;
    private string helpFull = "";
    private bool showHelp = false;
    private bool showHelpNext = false;
    private string helpMessage1 = "";
    private string helpMessage2 = "";


    private async Task Confirm()
    {
        if (UserFullNumber == correctFullNmb && UserRoot == correctRoot)
        {
            await gameBase.GoodAnswer();
            if(gameBase.all >= 10)
            {
                await gameBase.UpdateUserScore(authenticationStateTask,userProgressService);
                ready = false;
                return;
            }
            UserRoot = 0;
            UserFullNumber = 0;
            helpRoot = 0;
            helpFull = "";
            showHelp = false;
            showHelpNext = false;
        }
        else
        {
            await gameBase.WrongAnswer();
        }
    }

    private void Help()
    {
        if (showHelp == true)
        {
            showHelp = false;
            // showHelpNext = false;
        }
        else
        {
            showHelp = true;
            showHelpNext = false;
        }
    }

    private async Task GoBack()
    {
        await gameBase.UpdateUserScore(authenticationStateTask, userProgressService);
        NavManager.NavigateTo("ChooseGame/uname/Potęgi i Pierwiastki");
    }
}
