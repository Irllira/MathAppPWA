@page "/InputX"
@using DTO.DTOs
@using FrontEnd.Components.Classes
@using Microsoft.AspNetCore.Components.Authorization
@inherits AlgebraBase;
@inject NavigationManager NavManager
@rendermode InteractiveServer


@if (ready == true)
{

    <h1 style="text-align:center"> Policz wyrażenie algebraiczne dla liczby @x </h1>
    <p style="height:10px"></p>
    <left>
        <h2>
            <b>
                @excercise =
            </b>
        </h2>
        <h2>
            <b>
                <InputText @bind-Value="userInput[0]" style="width:50px; font-size:20px" /> * 
                <InputText @bind-Value="userX" style="width:50px; font-size:20px" />  @symbol
                <InputText @bind-Value="userInput[1]" style="width:50px; font-size:20px" />
                =
            </b>
        </h2>
        <h2>
            <b>
                =
                <InputText @bind-Value="userInput[2]" style="width:50px; font-size:20px" />   @symbol
                <InputText @bind-Value="userInput[1]" style="width:50px; font-size:20px" />
                =
            </b>
        </h2>

        <h2>
            <b>
                <InputText @bind-Value="userFinalInput" style="width:50px; font-size:20px" />
            </b>
        </h2>
        <p style="height:10px"></p>

        <button class="confbtn" @onclick="Confirm">Potwierdź</button>
        <p></p>
        <button class="helpbtn" @onclick="Help">Pomoc</button>
        <p style="height:5px"></p>
        <p>@message</p>
        <p style="height:5px"></p>

        <p style="height:5px"></p>

        <p>Wynik: @gameBase.good / @gameBase.all </p>

        <p style="height:50px"></p>
        <button class="backbtn" @onclick="GoBack">Cofnij</button>
    </left>
    <right>
        @if (showHints == true)
        {
            <h2>Pomoc: </h2>
            <p></p>

            <p> 
                x =
                <InputText @bind-Value="userX" style="width:50px; font-size:20px" />
            </p>
            <p></p>
            <p style="font-size:25px">
                @excerciseNumbers[0] * <InputText @bind-Value="userX" style="width:50px; font-size:20px" />
                = <InputText @bind-Value="userInput[2]" style="width:50px; font-size:20px" />
            </p>
            <!--<p style="font-size:25px">
                @excerciseNumbers[1] * <InputText @bind-Value="userX" style="width:50px; font-size:20px" />
                = <InputText @bind-Value="userInput[3]" style="width:50px; font-size:20px" />
            </p>-->

            <p style="font-size:25px">
                <InputText @bind-Value="userInput[2]" style="width:50px; font-size:20px" /> @symbol <InputText @bind-Value="userInput[1]" style="width:50px; font-size:20px" />
                = <InputText @bind-Value="userFinalInput" style="width:50px; font-size:20px" />
            </p>
        }


        @foreach (var h in hints)
        {
            <p>@h</p>
        }
    </right>
}
else
{
    <h2 style="text-align:center"><b>Koniec Gry!</b></h2>
    <p style="height:10px"></p>
    <h4>Twój wynik to: @gameBase.good / @gameBase.all </h4>

    <p style="height:50px"></p>
    <button class="backbtn" @onclick="GoBack">Cofnij</button>
}



@code {
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }

    private GamesBase gameBase = new GamesBase("Wyrażenia algebraiczne", "Gry");

    private string message = "";
    private string userX = "";
    private string[] userInput = ["", "", "", ""];

    private string userFinalInput = "";
    private string[] hints = ["", "", ""];

    private bool showHints = false;

    private async Task Confirm()
    {
        if (userFinalInput== FinalNumber + "" )
        {
            await gameBase.GoodAnswer();
            if (gameBase.all >= 10)
            {
                ready = false;
                await Task.Delay(1500);
                await gameBase.UpdateUserScore(authenticationStateTask, userProgressService);
            }
            else
            {
                PrepareNewGame();
                userInput = ["", "", "", ""];
                userFinalInput = "";
                hints = ["", "", ""];
                userX = "";
                showHints = false;
            }
        }
        else
        {
            await gameBase.WrongAnswer();
            CheckHints();
        }

    }

    private void CheckHints()
    {
        if(userX==x+"")
        {
            hints[0] = "Niewiadoma poprawnie wpisana";
        }else
        {
            hints[0] = "Niewiadoma niepoprawnie wpisana";
            return;
        }
        if (userInput[0] == excerciseNumbers[0]+"" &&userInput[1] == excerciseNumbers[1] +"" )
        {
            hints[1] = "Pierwsze równanie dobrze wpisane";
        }
        else
        {
            hints[1] = "Pierwsze równanie źle wpisane";
            return;
        }
        if (userInput[2] == excerciseNumbers[0]*x + "" && userInput[1] == excerciseNumbers[1] + "")
        {
            hints[2] = "Drugie równanie dobrze wpisane";
        }
        else
        {
            hints[2] = "Drugie równanie źle wpisane";
            return;
        }

    }

    private void Help()
    {
        if (showHints == false)
        {
            showHints = true;
        }
        else
        {
            showHints = false;
        }
    }


    private async Task GoBack()
    {
        await gameBase.UpdateUserScore(authenticationStateTask, userProgressService);

        NavManager.NavigateTo("ChooseGame/uname/Wyrażenia algebraiczne");
    }
}
